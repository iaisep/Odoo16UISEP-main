<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>
        <menuitem id="menu_downconsult_submenu" name="Encuestas de baja"
                  sequence="80"
                  parent="openeducat_admission.menu_admission_report_root"/>
        
        <!-- Modulo para para las preguntas -->
        <record id="view_downconsult_question_tree" model="ir.ui.view">
            <field name="name">view_downconsult_question_tree</field>
            <field name="model">admission.downconsult.question</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Preguntas" editable="bottom" create="true" edit="true" import="true" >
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>                 
                </tree>
            </field>
        </record>

        <record id="admission_downconsult_question_action" model="ir.actions.act_window">
            <field name="name">Preguntas para encuesta</field>
            <field name="res_model">admission.downconsult.question</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="isep_elearning_custom.view_downconsult_question_tree"/>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                        Crear nuevas preguntas
                </p>
            </field>            
        </record>        

        <menuitem id="menu_downconsult_question" name="Preguntas para encuesta"
                  sequence="10"
                  parent="isep_elearning_custom.menu_downconsult_submenu"
                  action="isep_elearning_custom.admission_downconsult_question_action"/>


        <!-- Modulo principal que crea la consulta -->

        <record id="view_downconsult_tree" model="ir.ui.view">
            <field name="name">view_downconsult_tree</field>
            <field name="model">admission.downconsult</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Preguntas" create="true" edit="true" import="true" > 
                    <field name="student_id"/>   
                    <field name="admission_id" />  
                    <field name="course_id" />   
                    <field name="state" widget="badge"/>   
                    <field name="create_date" string="Fecha de baja"/>
                    <field name="write_date" string="Fecha encuesta llena"/>    
                </tree>
            </field>
        </record>

        <record id="view_downconsult_form" model="ir.ui.view">
            <field name="name">view_downconsult_form</field>
            <field name="model">admission.downconsult</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_print_report_donw" string="Imprimir Baja" type="object" class="oe_highlight"/>
                        <button name="action_send_down_mail" string="Enviar correo baja" type="object" class="oe_highlight" states="draft"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="admission_id" readonly="1" />
                                <field name="student_id" readonly="1" />
                                <field name="course_id" readonly="1"/>
                                <field name="create_date" string="Fecha de baja"/>
                            </group>
                            <group>
                                <field name="write_date" string="Fecha encuesta llena"/>
                                <field name="partner_id" invisible="1" />
                                <field name="description" readonly="1"/>
                            </group>
                        
                        </group>
                        <notebook>
                            <page name="lines_consult" string="Preguntas">
                                <field name="question_line_ids" nolabel="1" readonly="1">
                                    <tree string="Preguntas" editable="bottom">
                                        <field name="name"/>
                                        <field name="rating" />
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" />
                        <field name="activity_ids" widget="mail_activity" />
                        <field name="message_ids" widget="mail_thread" />
                    </div>
                </form>                
            </field>
        </record>
        <record id="admission_downconsult_action" model="ir.actions.act_window">
            <field name="name">Encuestas de baja</field>
            <field name="res_model">admission.downconsult</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="isep_elearning_custom.view_downconsult_tree"/>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                       En espera de nuevas encuestas
                </p>
            </field>            
        </record>   
        <menuitem id="menu_downconsult" name="Encuestas de baja"
                  sequence="11"
                  parent="isep_elearning_custom.menu_downconsult_submenu"
                  action="isep_elearning_custom.admission_downconsult_action"/>

        <!-- Modulo lines de encuentas para graficos -->

        <record id="view_downconsult_line_search" model="ir.ui.view">
            <field name="name">view_downconsult_line_search</field>
            <field name="model">admission.downconsult.line</field>
            <field name="arch" type="xml">
                <search string="Busqueda">
                    <field name="course_id" string="Por curso" />
                    <field name="downconsult_id" string="Estudiante" />
                    <separator/>
                    <filter name="filter_today" string="Hoy" domain="[('create_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter name="filter_date" string="Fecha" date="create_date"/>
                    <separator/>
                    <group name="group_by_consult_lines" string="Group by">
                        <filter name="group_by_date" string="Por Fecha" context="{'group_by': 'create_date'}" />
                        <separator/>
                        <filter name="group_by_course" string="Curso" context="{'group_by': 'course_id'}" />
                        <filter name="group_by_batch" string="Lote" context="{'group_by': 'batch_id'}" />
                    </group>                    
                </search>
            </field>
        </record>
        <record id="view_downconsult_line_graph" model="ir.ui.view">
            <field name="name">view.downconsult.line.graph</field>
            <field name="model">admission.downconsult.line</field>
            <field name="arch" type="xml">
                <graph string="Gráfico de Ratings" type="bar">
                    <field name="rating" type="row"/>
                    <field name="id" type="measure" widget="count"/>
                </graph>
            </field>
        </record>
        <record id="view_downconsult_line_pivot" model="ir.ui.view">
            <field name="name">view.downconsult.line.pivot</field>
            <field name="model">admission.downconsult.line</field>
            <field name="arch" type="xml">
                <pivot string="Pivot de Calificaciones">                  
                    <field name="course_id" type="row"/>
                    <field name="create_date" type="col"/>
                    <field name="rating" type="col"/>
                </pivot>
            </field>
        </record>
        <record id="view_downconsult_line_tree" model="ir.ui.view">
            <field name="name">view_downconsult_line_tree</field>
            <field name="model">admission.downconsult.line</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Preguntas" create="true" edit="true" import="true" > 
                    <field name="name" readonly="1"/>    
                    <field name="course_id" readonly="1"/>   
                    <field name="rating" widget="badge" readonly="1"/>   
                    <field name="create_date" string="Fecha de baja"/>
                    <field name="write_date" string="Fecha encuesta llena"/>    
                </tree>
            </field>
        </record>
        <record id="view_downconsult_line_form" model="ir.ui.view">
            <field name="name">view_downconsult_line_form</field>
            <field name="model">admission.downconsult.line</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
            <form>
                <sheet>
                <group>
                    <field name="name" readonly="1"/>
                    <field name="course_id" readonly="1"/>
                    <field name="rating" readonly="1"/>
                    <field name="downconsult_id" readonly="1"/>
                    <field name="create_date" string="Fecha de baja"/>
                    <field name="write_date" string="Fecha encuesta llena"/>
                </group>
                </sheet>
            </form>
            </field>
        </record>
        <record id="action_downconsult_line_graph" model="ir.actions.act_window">
            <field name="name">Gráfico de Ratings</field>
            <field name="res_model">admission.downconsult.line</field>
            <field name="view_mode">graph,pivot,tree,form</field>
            <field name="view_id" ref="view_downconsult_line_graph"/>
            <field name="search_view_id" ref="view_downconsult_line_search"/>
            <field name="context">{}</field>
        </record>
        <menuitem id="menu_downconsult_line_graph" name="Gráfico de Ratings" sequence="12" parent="isep_elearning_custom.menu_downconsult_submenu"
          action="action_downconsult_line_graph"/>

    </data>  

</odoo>
